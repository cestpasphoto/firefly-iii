diff -Naur ../official/public/v1/js/ff/accounts/create.js ./public/v1/js/ff/accounts/create.js
--- ../official/public/v1/js/ff/accounts/create.js	2023-01-28 10:04:18.191880339 +0100
+++ ./public/v1/js/ff/accounts/create.js	2023-01-28 11:04:40.049174653 +0100
@@ -30,21 +30,4 @@
             }
         );
     }
-    // change the 'ffInput_opening_balance' text based on the
-    // selection of the direction.
-    $("#ffInput_liability_direction").change(triggerDirection);
-    triggerDirection();
 });
-
-
-function triggerDirection() {
-    let obj = $("#ffInput_liability_direction");
-    let direction = obj.val();
-    console.log('Direction is now ' + direction);
-    if('credit' === direction) {
-        $('label[for="ffInput_opening_balance"]').text(iAmOwed);
-    }
-    if('debit' === direction) {
-        $('label[for="ffInput_opening_balance"]').text(iOwe);
-    }
-}
diff -Naur ../official/public/v1/js/ff/accounts/edit.js ./public/v1/js/ff/accounts/edit.js
--- ../official/public/v1/js/ff/accounts/edit.js	2023-01-28 10:04:18.191880339 +0100
+++ ./public/v1/js/ff/accounts/edit.js	2023-01-28 11:04:40.041174332 +0100
@@ -30,21 +30,5 @@
             }
         );
     }
-    // change the 'ffInput_opening_balance' text based on the
-    // selection of the direction.
-    $("#ffInput_liability_direction").change(triggerDirection);
-    triggerDirection();
 
 });
-
-function triggerDirection() {
-    let obj = $("#ffInput_liability_direction");
-    let direction = obj.val();
-    console.log('Direction is now ' + direction);
-    if('credit' === direction) {
-        $('label[for="ffInput_opening_balance"]').text(iAmOwed);
-    }
-    if('debit' === direction) {
-        $('label[for="ffInput_opening_balance"]').text(iOwe);
-    }
-}
diff -Naur ../official/public/v1/js/ff/accounts/reconcile.js ./public/v1/js/ff/accounts/reconcile.js
--- ../official/public/v1/js/ff/accounts/reconcile.js	2022-05-06 16:20:55.829339578 +0200
+++ ./public/v1/js/ff/accounts/reconcile.js	2023-01-28 11:04:40.037174172 +0100
@@ -21,6 +21,7 @@
 var balanceDifference = 0;
 var difference = 0;
 var selectedAmount = 0;
+var initialSelectedAmount = 0;
 var reconcileStarted = false;
 var changedBalances = false;
 
@@ -41,6 +42,9 @@
             difference = balanceDifference - selectedAmount;
             updateDifference();
 
+            trigger_smart_reconcile();
+            difference = balanceDifference - selectedAmount;
+            updateDifference();
         }
         changedBalances = true;
     });
@@ -69,6 +73,98 @@
 
 });
 
+function smart_reconcile(amounts, target_sum) {
+    let d_size = amounts.length;
+    let max_sum = amounts.reduce((a, b) => a + b);
+    // Define number of maximum items to uncheck in order to keep short computing time
+    // Here are some pre-computed values ensuring less than 1e7 combinations to explore
+    // 10 -> 10, 20 -> 20, 22 -> 22, 24 -> 12, 26 -> 9, 30 -> 8, 40 -> 6, 50 -> 5, 100 -> 4
+    // next line is a magic formula fitting these values
+    let max_nb_items = (d_size <= 22) ? d_size : Math.floor( 13*(d_size-22)**-0.3 );
+    console.log('debug smart_reconcile:', target_sum, max_sum, max_nb_items);
+    // Result is list of items NOT to check
+    let result = smart_reconcile_aux(amounts, 0, max_nb_items, 0, max_sum-target_sum);
+    return result;
+}
+
+// Recursive function, try to add the amounts after the 'nth' one to achieve 'target_sum'
+// without exceeding maximum number of items 'remain_to_take'
+// Returns null if not possible else boolean array listing which items to check
+function smart_reconcile_aux(amounts, nth_number, remain_to_take, current_sum, target_sum) {
+    // Stop if no more transactions can be checked
+    if (Math.abs(current_sum - target_sum) < 0.01) return Array(amounts.length-nth_number).fill(false);
+    if (remain_to_take == 0 || nth_number == amounts.length) return null;
+
+    // Try without using current number
+    let result = smart_reconcile_aux(amounts, nth_number+1, remain_to_take, current_sum, target_sum);
+    if (result) {
+        result.unshift(false);
+        return result;
+    }
+
+    // Try using current number
+    let new_amount = amounts[nth_number];
+    let new_sum = current_sum + new_amount;
+    if (Math.abs(new_sum - target_sum) < 1e-8) return [true].concat(Array(amounts.length-nth_number-1).fill(false));
+    result = smart_reconcile_aux(amounts, nth_number+1, remain_to_take-1, new_sum, target_sum);
+    if (result) result.unshift(true);
+    return result;
+}
+
+function trigger_smart_reconcile() {
+    // Gather all data
+    let amounts = [];
+    $('.reconcile_checkbox').each(function (i, v) {
+        var check = $(v);
+        amounts.push(parseFloat(check.val()));
+    });
+
+    // Call core function, better to serch for items to uncheck than the ones to check
+    var items_to_uncheck = smart_reconcile(amounts, initialSelectedAmount - balanceDifference);
+    if (items_to_uncheck) {
+        // Set checkboxes
+        $('.reconcile_checkbox').each(function (i, v) {
+            var check = $(v);
+            changeReconciledBoxAndUpdate(check, !items_to_uncheck[i]);
+        });
+    } else {
+        console.log('Cant find a solution for smart reconcile');
+    }
+}
+
+// Change status of el to targetState and update all variables
+// If targetState is null, then assumes that state is alreay changed and only update variables
+function changeReconciledBoxAndUpdate(el, targetState) {
+    var amount = parseFloat(el.val());
+    var journalId = parseInt(el.data('id'));
+    var identifier = 'checked_' + journalId;
+    console.log('in changeReconciledBoxAndUpdate(' + journalId + ') with amount ' + amount + ' selected amount ' + selectedAmount + ' and targetState=' + targetState);
+
+    if (targetState != null) {
+        // do nothing if line is already in target state
+        if (el.prop('checked') === targetState) {
+            return;
+        }
+        el.prop('checked', targetState);
+    }
+
+    // if checked, add to selected amount
+    if (el.prop('checked') === true && el.data('younger') === false) {
+        selectedAmount = selectedAmount - amount;
+        //console.log('checked = true and younger = false so selected amount = ' + selectedAmount);
+        localStorage.setItem(identifier, 'true');
+    }
+    // if unchecked, substract from selected amount
+    if (el.prop('checked') === false && el.data('younger') === false) {
+        selectedAmount = selectedAmount + amount;
+        //console.log('checked = false and younger = false so selected amount = ' + selectedAmount);
+        localStorage.setItem(identifier, 'false');
+    }
+    difference = balanceDifference - selectedAmount;
+    //console.log('Difference is now ' + difference);
+    updateDifference();
+}
+
 function selectAllReconcile(e) {
     // loop all, check.
     var el = $(e.target);
@@ -83,29 +179,7 @@
 
     $('.reconcile_checkbox').each(function (i, v) {
         var check = $(v);
-        var amount = parseFloat(check.val());
-        var journalId = parseInt(check.data('id'));
-        var identifier = 'checked_' + journalId;
-        console.log('in selectAllReconcile(' + journalId + ') with amount ' + amount + ' and selected amount ' + selectedAmount);
-
-        // do nothing if line is already in target state
-        if (check.prop('checked') === doCheck )
-            return;
-    
-        check.prop('checked', doCheck);
-        // if checked, add to selected amount
-        if (doCheck === true && check.data('younger') === false) {
-            selectedAmount = selectedAmount - amount;
-            //console.log('checked = true and younger = false so selected amount = ' + selectedAmount);
-            localStorage.setItem(identifier, 'true');
-        }
-        if (doCheck === false && check.data('younger') === false) {
-            selectedAmount = selectedAmount + amount;
-            //console.log('checked = false and younger = false so selected amount = ' + selectedAmount);
-            localStorage.setItem(identifier, 'false');
-        }
-        difference = balanceDifference - selectedAmount;
-        //console.log('Difference is now ' + difference);
+        changeReconciledBoxAndUpdate(check, doCheck);
     });
 
     updateDifference();
@@ -153,26 +227,7 @@
  * @param e
  */
 function checkReconciledBox(e) {
-
-    var el = $(e.target);
-    var amount = parseFloat(el.val());
-    var journalId = parseInt(el.data('id'));
-    var identifier = 'checked_' + journalId;
-    //console.log('in checkReconciledBox(' + journalId + ') with amount ' + amount + ' and selected amount ' + selectedAmount);
-    // if checked, add to selected amount
-    if (el.prop('checked') === true && el.data('younger') === false) {
-        selectedAmount = selectedAmount - amount;
-        //console.log('checked = true and younger = false so selected amount = ' + selectedAmount);
-        localStorage.setItem(identifier, 'true');
-    }
-    if (el.prop('checked') === false && el.data('younger') === false) {
-        selectedAmount = selectedAmount + amount;
-        //console.log('checked = false and younger = false so selected amount = ' + selectedAmount);
-        localStorage.setItem(identifier, 'false');
-    }
-    difference = balanceDifference - selectedAmount;
-    //console.log('Difference is now ' + difference);
-    updateDifference();
+    changeReconciledBoxAndUpdate($(e.target), null);
 }
 
 
@@ -266,6 +321,7 @@
 
     difference = balanceDifference - selectedAmount;
     updateDifference();
+    initialSelectedAmount = selectedAmount;
 
     // loop al placed checkboxes and check them if necessary.
     restoreFromLocalStorage();
@@ -331,12 +387,12 @@
 }
 
 function updateDifference() {
-    console.log('in updateDifference()');
+    //console.log('in updateDifference()');
     var addClass = 'text-info';
-    if (difference > 0) {
+    if (difference > 0.01) {
         addClass = 'text-success';
     }
-    if (difference < 0) {
+    if (difference < -0.01) {
         addClass = 'text-danger';
     }
     $('#difference').addClass(addClass).text(accounting.formatMoney(difference));
diff -Naur ../official/public/v1/js/ff/budgets/index.js ./public/v1/js/ff/budgets/index.js
--- ../official/public/v1/js/ff/budgets/index.js	2023-03-15 08:36:59.135380515 +0100
+++ ./public/v1/js/ff/budgets/index.js	2023-03-15 08:37:07.279486846 +0100
@@ -29,9 +29,9 @@
     drawSpentBars();
     drawBudgetedBars();
 
-    //$('.update_ab').on('click', updateAvailableBudget);
-    //$('.delete_ab').on('click', deleteAvailableBudget);
-    //$('.create_ab_alt').on('click', createAltAvailableBudget);
+    $('.update_ab').on('click', updateAvailableBudget);
+    $('.delete_ab').on('click', deleteAvailableBudget);
+    $('.create_ab_alt').on('click', createAltAvailableBudget);
 
     $('.budget_amount').on('change', updateBudgetedAmount);
     $('.create_bl').on('click', createBudgetLimit);
@@ -129,28 +129,20 @@
 }
 
 function updateTotalBudgetedAmount(currencyId) {
-    console.log('updateTotalBudgetedAmount');
     // fade info away:
     $('span.budgeted_amount[data-currency="' + currencyId + '"]')
         .fadeTo(100, 0.1, function () {
-        });
-    $('span.available_amount[data-currency="' + currencyId + '"]')
-        .fadeTo(100, 0.1, function () {
+            //$(this).fadeTo(500, 1.0);
         });
 
     // get new amount:
     $.get(totalBudgetedUrl.replace('REPLACEME', currencyId)).done(function (data) {
         // set thing:
-
         $('span.budgeted_amount[data-currency="' + currencyId + '"]')
             .html(data.budgeted_formatted)
             // fade back:
             .fadeTo(300, 1.0);
 
-        // also set available amount:
-        $('span.available_amount[data-currency="' + currencyId + '"]')
-            .html(data.available_formatted).fadeTo(300, 1.0);
-
         // set bar:
         var pct = parseFloat(data.percentage);
         if (pct <= 100) {
diff -Naur ../official/public/v1/js/ff/rules/create-edit.js ./public/v1/js/ff/rules/create-edit.js
--- ../official/public/v1/js/ff/rules/create-edit.js	2023-01-14 16:08:04.965752279 +0100
+++ ./public/v1/js/ff/rules/create-edit.js	2023-01-28 11:04:39.385148015 +0100
@@ -232,16 +232,11 @@
             break;
         case 'clear_category':
         case 'clear_budget':
-        case 'append_descr_to_notes':
-        case 'append_notes_to_descr':
-        case 'move_descr_to_notes':
-        case 'move_notes_to_descr':
         case 'clear_notes':
         case 'delete_transaction':
         case 'remove_all_tags':
             console.log('Select list value is ' + selectList.val() + ', so input needs to be disabled.');
-            inputResult.prop('disabled', true);
-            inputResult.typeahead('destroy');
+            inputResult.attr('disabled', 'disabled');
             break;
         case 'set_budget':
             console.log('Select list value is ' + selectList.val() + ', so input needs auto complete.');
@@ -348,12 +343,9 @@
         case 'has_no_tag':
         case 'no_notes':
         case 'any_notes':
-        case 'exists':
-        case 'reconciled':
         case 'has_any_tag':
         case 'has_attachments':
         case 'source_is_cash':
-        case 'has_no_attachments':
         case 'destination_is_cash':
         case 'account_is_cash':
         case 'no_external_url':
@@ -372,7 +364,7 @@
         case 'amount_exactly':
             console.log('Set value to type=number');
             inputResult.prop('type', 'number');
-            inputResult.prop('step', 'any');
+            inputResult.prop('step','any');
             break;
         default:
             console.log('Select list value is ' + selectList.val() + ', destroy auto complete, do nothing else.');
@@ -391,32 +383,32 @@
     input.typeahead('destroy');
 
     // append URL:
-    var lastChar = URL[URL.length - 1];
+    var lastChar = URL[URL.length -1];
     var urlParamSplit = '?';
-    if ('&' === lastChar) {
+    if('&' === lastChar) {
         urlParamSplit = '';
     }
     var source = new Bloodhound({
-        datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
-        queryTokenizer: Bloodhound.tokenizers.whitespace,
-        prefetch: {
-            url: URL + urlParamSplit + 'uid=' + uid,
-            filter: function (list) {
-                return $.map(list, function (item) {
-                    return {name: item.name};
-                });
-            }
-        },
-        remote: {
-            url: URL + urlParamSplit + 'query=%QUERY&uid=' + uid,
-            wildcard: '%QUERY',
-            filter: function (list) {
-                return $.map(list, function (item) {
-                    return {name: item.name};
-                });
-            }
-        }
-    });
+                                    datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
+                                    queryTokenizer: Bloodhound.tokenizers.whitespace,
+                                    prefetch: {
+                                        url: URL + urlParamSplit + 'uid=' + uid,
+                                        filter: function (list) {
+                                            return $.map(list, function (item) {
+                                                return {name: item.name};
+                                            });
+                                        }
+                                    },
+                                    remote: {
+                                        url: URL + urlParamSplit + 'query=%QUERY&uid=' + uid,
+                                        wildcard: '%QUERY',
+                                        filter: function (list) {
+                                            return $.map(list, function (item) {
+                                                return {name: item.name};
+                                            });
+                                        }
+                                    }
+                                });
     source.initialize();
     input.typeahead({hint: true, highlight: true,}, {source: source, displayKey: 'name', autoSelect: false});
 }
diff -Naur ../official/public/v1/js/ff/rules/select-transactions.js ./public/v1/js/ff/rules/select-transactions.js
--- ../official/public/v1/js/ff/rules/select-transactions.js	2023-01-14 16:08:04.969752440 +0100
+++ ./public/v1/js/ff/rules/select-transactions.js	2023-01-28 11:04:39.373147534 +0100
@@ -29,4 +29,7 @@
             }
         );
     }
+    // $('form.form-horizontal').on('submit', function () {
+    //     return confirm(askReadWarning);
+    // });
 });
diff -Naur ../official/resources/assets/js/components/transactions/CreateTransaction.vue ./resources/assets/js/components/transactions/CreateTransaction.vue
--- ../official/resources/assets/js/components/transactions/CreateTransaction.vue	2023-03-15 08:36:59.151380724 +0100
+++ ./resources/assets/js/components/transactions/CreateTransaction.vue	2023-03-15 08:37:07.299487107 +0100
@@ -134,35 +134,14 @@
                       :transactionType="transactionType"
                       v-bind:title="$t('form.foreign_amount')"
                   ></foreign-amount>
-                </div>
-                <div id="optional-info" class="col-lg-4">
                   <budget
                       v-model="transaction.budget"
                       :error="transaction.errors.budget_id"
                       :no_budget="$t('firefly.none_in_select_list')"
                       :transactionType="transactionType"
                   ></budget>
-                  <category
-                      v-model="transaction.category"
-                      :error="transaction.errors.category"
-                      :transactionType="transactionType"
-                  ></category>
-                  <piggy-bank
-                      v-model="transaction.piggy_bank"
-                      :error="transaction.errors.piggy_bank"
-                      :no_piggy_bank="$t('firefly.no_piggy_bank')"
-                      :transactionType="transactionType"
-                  ></piggy-bank>
-                  <tags
-                      v-model="transaction.tags"
-                      :error="transaction.errors.tags"
-                  ></tags>
-                  <bill
-                      v-model="transaction.bill"
-                      :error="transaction.errors.bill_id"
-                      :no_bill="$t('firefly.none_in_select_list')"
-                      :transactionType="transactionType"
-                  ></bill>
+                </div>
+                <div id="optional-info" class="col-lg-4">
                   <custom-transaction-fields
                       v-model="transaction.custom_fields"
                       :error="transaction.errors.custom_errors"
diff -Naur ../official/resources/lang/en_US/firefly.php ./resources/lang/en_US/firefly.php
--- ../official/resources/lang/en_US/firefly.php	2023-03-15 08:36:59.167380933 +0100
+++ ./resources/lang/en_US/firefly.php	2023-03-15 08:37:07.311487263 +0100
@@ -1269,6 +1269,7 @@
     'pref_view_range_help'                      => 'Some charts are automatically grouped in periods. Your budgets will also be grouped in periods. What period would you prefer?',
     'pref_1D'                                   => 'One day',
     'pref_1W'                                   => 'One week',
+    'pref_3W'                                   => 'Three weeks centered',
     'pref_1M'                                   => 'One month',
     'pref_3M'                                   => 'Three months (quarter)',
     'pref_6M'                                   => 'Six months',
diff -Naur ../official/resources/lang/fr_FR/firefly.php ./resources/lang/fr_FR/firefly.php
--- ../official/resources/lang/fr_FR/firefly.php	2023-03-15 08:36:59.171380985 +0100
+++ ./resources/lang/fr_FR/firefly.php	2023-03-15 08:37:07.319487368 +0100
@@ -1309,6 +1309,7 @@
     'pref_view_range_help'                      => 'Certains graphiques sont automatiquement regroupés par périodes. Vos budgets seront aussi organisés par périodes. Quelle période préférez-vous ?',
     'pref_1D'                                   => 'Un jour',
     'pref_1W'                                   => 'Une semaine',
+    'pref_3W'                                   => 'Trois semaines centrees',
     'pref_1M'                                   => 'Un mois',
     'pref_3M'                                   => 'Trois mois (trimestre)',
     'pref_6M'                                   => 'Six mois',
diff -Naur ../official/resources/views/accounts/reconcile/index.twig ./resources/views/accounts/reconcile/index.twig
--- ../official/resources/views/accounts/reconcile/index.twig	2022-12-29 16:01:27.132300233 +0100
+++ ./resources/views/accounts/reconcile/index.twig	2022-12-29 16:01:29.804338669 +0100
@@ -134,4 +134,7 @@
         var selectRangeAndBalance = '{{ 'select_range_and_balance'|_|escape('js') }}';
     </script>
     <script src="v1/js/ff/accounts/reconcile.js?v={{ FF_VERSION }}" type="text/javascript" nonce="{{ JS_NONCE }}"></script>
+    <script type="text/javascript" nonce="{{ JS_NONCE }}">
+        document.addEventListener('DOMContentLoaded', startReconcile, false);
+    </script>
 {% endblock %}
diff -Naur ../official/resources/views/index.twig ./resources/views/index.twig
--- ../official/resources/views/index.twig	2023-03-15 08:36:59.187381194 +0100
+++ ./resources/views/index.twig	2023-03-15 08:37:07.335487577 +0100
@@ -4,7 +4,6 @@
     {{ Breadcrumbs.render }}
 {% endblock %}
 {% block content %}
-    {% include 'partials.boxes' %}
     <div class="row">
         <div class="col-lg-8 col-md-12 col-sm-12">
             {# ACCOUNTS #}
@@ -36,22 +35,6 @@
                     </a>
                 </div>
             </div>
-            {# CATEGORIES #}
-            <div class="box">
-                <div class="box-header with-border">
-                    <h3 class="box-title"><a href="{{ route('categories.index') }}" title="{{ 'categories'|_ }}">{{ 'categories'|_ }}</a></h3>
-
-                </div>
-                <div class="box-body">
-                    <canvas id="categories-chart" style="width:100%;height:400px;" height="400" width="100%"></canvas>
-                </div>
-                <div class="box-footer">
-                    <a href="{{ route('categories.index') }}" class="btn btn-default button-sm">
-                        <span class="fa fa-bookmark"></span>
-                        <span>{{ 'go_to_categories'|_ }}</span>
-                    </a>
-                </div>
-            </div>
         </div>
         <div class="col-lg-4 col-md-6 col-sm-12">
 
@@ -106,64 +89,6 @@
                     </div>
                 {% endfor %}
             </div>
-
-            {% if billCount > 0 %}
-                {# BILLS #}
-                <div class="box">
-                    <div class="box-header with-border">
-                        <h3 class="box-title"><a href="{{ route('bills.index') }}" title="{{ 'bills'|_ }}">{{ 'bills'|_ }}</a></h3>
-
-                    </div>
-                    <div class="box-body">
-                        <div style="width:100%;margin:0 auto;">
-                            <canvas id="bills-chart" style="width:100%;height:200px;" height="200"></canvas>
-                        </div>
-                    </div>
-                    <div class="box-footer">
-                        <a href="{{ route('bills.index') }}" class="btn btn-default button-sm"><span
-                                    class="fa fa-calendar"></span> {{ 'go_to_bills'|_ }}</a>
-                    </div>
-                </div>
-            {% endif %}
-
-            {# box for piggy bank data (JSON) #}
-            <div id="piggy_bank_overview">
-
-            </div>
-        </div>
-    </div>
-    <div class="row">
-        <div class="col-lg-12 col-md-12 col-sm-12">
-            {# EXPENSE ACCOUNTS #}
-            <div class="box">
-                <div class="box-header with-border">
-                    <h3 class="box-title"><a href="{{ route('accounts.index',['expense']) }}"
-                                             title="{{ 'expense_accounts'|_ }}">{{ 'expense_accounts'|_ }}</a>
-                    </h3>
-                </div>
-                <div class="box-body">
-                    <canvas id="expense-accounts-chart" style="width:100%;height:400px;" height="400" width="100%"></canvas>
-                </div>
-                <div class="box-footer">
-                    <a href="{{ route('accounts.index', ['expense']) }}" class="btn btn-default button-sm"><span
-                                class="fa fa-shopping-cart"></span> {{ 'go_to_expense_accounts'|_ }}</a>
-                </div>
-            </div>
-            {# OPTIONAL REVENUE ACCOUNTS #}
-            <div class="box">
-                <div class="box-header with-border">
-                    <h3 class="box-title"><a href="{{ route('accounts.index',['revenue']) }}"
-                                             title="{{ 'revenue_accounts'|_ }}">{{ 'revenue_accounts'|_ }}</a></h3>
-
-                </div>
-                <div class="box-body">
-                    <canvas id="revenue-accounts-chart" style="width:100%;height:400px;" height="400" width="100%"></canvas>
-                </div>
-                <div class="box-footer">
-                    <a href="{{ route('accounts.index', ['revenue']) }}" class="btn btn-default button-sm"><span
-                                class="fa fa-download"></span> {{ 'go_to_revenue_accounts'|_ }}</a>
-                </div>
-            </div>
         </div>
     </div>
 {% endblock %}
diff -Naur ../official/resources/views/layout/default.twig ./resources/views/layout/default.twig
--- ../official/resources/views/layout/default.twig	2023-03-15 08:36:59.187381194 +0100
+++ ./resources/views/layout/default.twig	2023-03-15 08:37:07.335487577 +0100
@@ -97,11 +97,22 @@
                         </span>
                     </li>
 
-                    <li class="dropdown user user-menu">
-                    <span style="cursor:default;color:#fff;padding: 15px;display: block;line-height: 20px;">
-                        <span class="hidden-xs">{{ Auth.user.email }}</span>
-                    </span>
+                    <li>
+                        <a href="{{ route('transactions.create', 'withdrawal') }}">
+                            <span class="fa fa-long-arrow-left bg-red" style="font-size:20px;border-radius:50%"></span>
+                        </a>
                     </li>
+                    <li>
+                        <a href="{{ route('transactions.create', 'deposit') }}">
+                            <span class="fa fa-long-arrow-right bg-green" style="font-size:20px;border-radius:50%"></span>
+                        </a>
+                    </li>
+                    <li>
+                        <a href="{{ route('transactions.create', 'transfer') }}">
+                            <span class="fa fa-exchange bg-blue" style="font-size:20px;border-radius:50%"></span>
+                        </a>
+                    </li>
+
                     <li id="sidebar-toggle">
                         <a href="#" data-toggle="control-sidebar"><span class="fa fa-plus-circle"></span></a>
                     </li>
diff -Naur ../official/resources/views/list/groups-tiny.twig ./resources/views/list/groups-tiny.twig
--- ../official/resources/views/list/groups-tiny.twig	2022-01-30 07:42:09.304120315 +0100
+++ ./resources/views/list/groups-tiny.twig	2022-07-16 08:07:47.682616812 +0200
@@ -7,7 +7,12 @@
             {{ transaction.description }}
 
             <span class="pull-right small">
-          {% if transaction.transaction_type_type == 'Deposit' %}
+          {% if transaction.date > date('now') %}
+              {#  future transactions:  #}
+              <span class="text-secondary">
+                  {{ formatAmountBySymbol(transaction.amount|abs, transaction.currency_symbol, transaction.currency_decimal_places, false) }}
+              </span>
+          {% elseif transaction.transaction_type_type == 'Deposit' %}
               {{ formatAmountBySymbol(transaction.amount*-1, transaction.currency_symbol, transaction.currency_decimal_places) }}
               {% if null != transaction.foreign_amount %}
                   ({{ formatAmountBySymbol(transaction.foreign_amount*-1, transaction.foreign_currency_symbol, transaction.foreign_currency_decimal_places) }})
diff -Naur ../official/resources/views/preferences/index.twig ./resources/views/preferences/index.twig
--- ../official/resources/views/preferences/index.twig	2023-03-15 08:36:59.187381194 +0100
+++ ./resources/views/preferences/index.twig	2023-03-15 08:43:00.656081570 +0100
@@ -196,30 +196,24 @@
                                         <div class="radio">
                                             <label>
                                                 <input type="radio" name="viewRange"
-                                                       value="last7" {% if viewRange == 'last7' %} checked {% endif %}>
-                                                {{ 'pref_last7'|_ }}
+                                                       value="3W" {% if viewRange == '3W' %} checked {% endif %}>
+                                                {{ 'pref_3W'|_ }}
                                             </label>
                                         </div>
 
                                         <div class="radio">
                                             <label>
                                                 <input type="radio" name="viewRange"
-                                                       value="1M" {% if viewRange == '1M' %} checked {% endif %}>
-                                                {{ 'pref_1M'|_ }}
-                                            </label>
-                                        </div>
-                                        <div class="radio">
-                                            <label>
-                                                <input type="radio" name="viewRange"
-                                                       value="last30" {% if viewRange == 'last30' %} checked {% endif %}>
-                                                {{ 'pref_last30'|_ }}
+                                                       value="last7" {% if viewRange == 'last7' %} checked {% endif %}>
+                                                {{ 'pref_last7'|_ }}
                                             </label>
                                         </div>
+
                                         <div class="radio">
                                             <label>
                                                 <input type="radio" name="viewRange"
-                                                       value="MTD" {% if viewRange == 'MTD' %} checked {% endif %}>
-                                                {{ 'pref_MTD'|_ }}
+                                                       value="1M" {% if viewRange == '1M' %} checked {% endif %}>
+                                                {{ 'pref_1M'|_ }}
                                             </label>
                                         </div>
 
diff -Naur ../official/app/Http/Controllers/Account/ReconcileController.php ./app/Http/Controllers/Account/ReconcileController.php
--- ../official/app/Http/Controllers/Account/ReconcileController.php	2023-03-15 08:36:59.099380045 +0100
+++ ./app/Http/Controllers/Account/ReconcileController.php	2023-03-15 08:38:49.120814561 +0100
@@ -99,18 +99,15 @@
         }
         $currency = $this->accountRepos->getAccountCurrency($account) ?? app('amount')->getDefaultCurrency();
 
-        // no start or end:
-        $range = app('navigation')->getViewRange(false);
-
-        // get start and end
-
+        // compute values of 'start' and 'end' whatever the preferred range is
         if (null === $start && null === $end) {
-            /** @var Carbon $start */
-            $start = clone session('start', app('navigation')->startOfPeriod(new Carbon(), $range));
-            /** @var Carbon $end */
-            $end = clone session('end', app('navigation')->endOfPeriod(new Carbon(), $range));
+           /** @var Carbon $start */
+           $start = clone (new Carbon)->subMonth();
+           /** @var Carbon $end */
+           $end = clone (new Carbon);
         }
         if (null === $end) {
+            $range = app('preferences')->get('viewRange', '1M')->data;
             /** @var Carbon $end */
             $end = app('navigation')->endOfPeriod($start, $range);
         }
diff -Naur ../official/app/Http/Controllers/Chart/AccountController.php ./app/Http/Controllers/Chart/AccountController.php
--- ../official/app/Http/Controllers/Chart/AccountController.php	2023-03-15 08:36:59.099380045 +0100
+++ ./app/Http/Controllers/Chart/AccountController.php	2023-03-15 08:37:07.243486376 +0100
@@ -495,7 +495,7 @@
                 $current->addDay();
             }
         }
-        if ('1W' === $step || '1M' === $step || '1Y' === $step) {
+        if ('1W' === $step || '3W' === $step || '1M' === $step || '1Y' === $step) {
             while ($end >= $current) {
                 $balance         = (float)app('steam')->balance($account, $current, $currency);
                 $label           = app('navigation')->periodShow($current, $step);
diff -Naur ../official/app/Jobs/CreateRecurringTransactions.php ./app/Jobs/CreateRecurringTransactions.php
--- ../official/app/Jobs/CreateRecurringTransactions.php	2023-03-15 08:36:59.107380149 +0100
+++ ./app/Jobs/CreateRecurringTransactions.php	2023-03-15 08:37:07.247486428 +0100
@@ -92,6 +92,8 @@
         $this->created           = 0;
         $this->recurrences       = new Collection();
         $this->groups            = new Collection();
+        $this->days_max_late     = 8;
+        $this->days_max_early    = 8;
 
         Log::debug(sprintf('Created new CreateRecurringTransactions("%s")', $this->date->format('Y-m-d')));
     }
@@ -332,10 +334,10 @@
             );
 
             // start looping from $startDate to today perhaps we have a hit?
-            // add two days to $this->date, so we always include the weekend.
-            $includeWeekend = clone $this->date;
-            $includeWeekend->addDays(2);
-            $occurrences = $this->repository->getOccurrencesInRange($repetition, $recurrence->first_date, $includeWeekend);
+            // add few days to anticipate next occurrences
+            $endDate = clone $this->date;
+            $endDate->addDays($this->days_max_early);
+            $occurrences = $this->repository->getOccurrencesInRange($repetition, $recurrence->first_date, $endDate);
 
             unset($includeWeekend);
 
@@ -383,10 +385,18 @@
     private function handleOccurrence(Recurrence $recurrence, RecurrenceRepetition $repetition, Carbon $date): ?TransactionGroup
     {
         $date->startOfDay();
-        if ($date->ne($this->date)) {
+
+        // allow some margin in the future (to anticipate) and in the past (in case cron was not executed)
+        $datediff = $date->diffInDays($this->date);
+        if ($datediff > $this->days_max_early) {
+            //print "date too much in the future\n";
+            return null;
+        }
+        if ($datediff < -$this->days_max_late) {
+            //print "date too much in the past\n";
             return null;
         }
-        Log::debug(sprintf('%s IS today (%s)', $date->format('Y-m-d'), $this->date->format('Y-m-d')));
+        Log::debug(sprintf('%s IS close to today (%s)', $date->format('Y-m-d'), $this->date->format('Y-m-d')));
 
         // count created journals on THIS day.
         $journalCount = $this->repository->getJournalCount($recurrence, $date, $date);
diff -Naur ../official/app/Support/Http/Controllers/GetConfigurationData.php ./app/Support/Http/Controllers/GetConfigurationData.php
--- ../official/app/Support/Http/Controllers/GetConfigurationData.php	2023-03-15 08:36:59.119380306 +0100
+++ ./app/Support/Http/Controllers/GetConfigurationData.php	2023-03-15 08:37:07.259486584 +0100
@@ -133,10 +133,15 @@
         }
 
         // today:
-        /** @var Carbon $todayStart */
-        $todayStart = app('navigation')->startOfPeriod($today, $viewRange);
-        /** @var Carbon $todayEnd */
-        $todayEnd = app('navigation')->endOfPeriod($todayStart, $viewRange);
+        if ('3W' === $viewRange) {
+            $todayStart = Carbon::now()->subDays(14);
+            $todayEnd = Carbon::now()->addDays(7);
+        } else {
+            /** @var Carbon $todayStart */
+            $todayStart = app('navigation')->startOfPeriod($today, $viewRange);
+            /** @var Carbon $todayEnd */
+            $todayEnd = app('navigation')->endOfPeriod($todayStart, $viewRange);
+        }
         if ($todayStart->ne($start) || $todayEnd->ne($end)) {
             $ranges[ucfirst((string)trans('firefly.today'))] = [$todayStart, $todayEnd];
         }
diff -Naur ../official/app/Support/Navigation.php ./app/Support/Navigation.php
--- ../official/app/Support/Navigation.php	2023-03-15 08:36:59.119380306 +0100
+++ ./app/Support/Navigation.php	2023-03-15 08:41:09.894644800 +0100
@@ -53,6 +53,7 @@
             '1W'        => 'addWeeks',
             'weekly'    => 'addWeeks',
             'week'      => 'addWeeks',
+            '3W'        => 'addWeeks',
             '1M'        => 'addMonths',
             'month'     => 'addMonths',
             'monthly'   => 'addMonths',
@@ -67,6 +68,7 @@
             'custom'    => 'addMonths', // custom? just add one month.
         ];
         $modifierMap = [
+            '3W'        => 3,
             'quarter'   => 3,
             '3M'        => 3,
             'quarterly' => 3,
@@ -219,7 +221,7 @@
         }
 
 
-        if ('custom' === $repeatFreq) {
+        if ('custom' === $repeatFreq || '3W' === $repeatFreq) {
             return $date; // the date is already at the start.
         }
         Log::error(sprintf('Cannot do startOfPeriod for $repeat_freq "%s"', $repeatFreq));
@@ -243,6 +245,7 @@
             '1W'        => 'addWeek',
             'week'      => 'addWeek',
             'weekly'    => 'addWeek',
+            '3W'        => 'addWeeks',
             '1M'        => 'addMonth',
             'month'     => 'addMonth',
             'monthly'   => 'addMonth',
@@ -257,6 +260,7 @@
             '1Y'        => 'addYear',
         ];
         $modifierMap = [
+            '3W'        => 3,
             'quarter'   => 3,
             '3M'        => 3,
             'quarterly' => 3,
@@ -265,7 +269,7 @@
             '6M'        => 6,
         ];
 
-        $subDay = ['week', 'weekly', '1W', 'month', 'monthly', '1M', '3M', 'quarter', 'quarterly', '6M', 'half-year', 'half_year', '1Y', 'year', 'yearly'];
+        $subDay = ['week', 'weekly', '1W', 'month', 'monthly', '3W', '1M', '3M', 'quarter', 'quarterly', '6M', 'half-year', 'half_year', '1Y', 'year', 'yearly'];
 
         // if the range is custom, the end of the period
         // is another X days (x is the difference between start)
@@ -615,6 +619,10 @@
 
             return $date;
         }
+        if ('3W' === $repeatFreq) {
+            $date->subDays(21);
+            return $date;
+        }
         // a custom range requires the session start
         // and session end to calculate the difference in days.
         // this is then subtracted from $theDate (* $subtract).
@@ -684,6 +692,11 @@
 
             return $end;
         }
+
+        if ('3W' === $range) {
+            $end->addDays(21);
+            return $end;
+        }
         if ('6M' === $range) {
             if ($start->month >= 7) {
                 $end->endOfYear();
@@ -769,6 +782,9 @@
             case 'last7':
                 $start->subDays(7);
                 return $start;
+            case '3W':
+                $start->subDays(14);
+                return $start;
             case 'last30':
                 $start->subDays(30);
                 return $start;
